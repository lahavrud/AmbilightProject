<!DOCTYPE html>
<html dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>שליטה בתאורה</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #001f3f;
        color: white;
        padding: 20px;
      }
      h1 {
        color: #f39c12;
      }
      .btn {
        background-color: #444;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 10px;
      }
      .btn:active {
        background-color: #666;
      }
      .red {
        background-color: #e74c3c;
      }
      .green {
        background-color: #2ecc71;
      }
      .blue {
        background-color: #3498db;
      }
      .rainbow {
        background-image: linear-gradient(
          to right,
          red,
          orange,
          yellow,
          green,
          blue,
          indigo,
          violet
        );
      }
      .ambilight {
        background-color: #9b59b6;
      }
      .off {
        background-color: #000;
        border: 1px solid #555;
      }

      /* עיצוב בוחר הצבעים */
      input[type="color"] {
        width: 100px;
        height: 50px;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>החדר של להב</h1>

    <p>בחר צבע:</p>
    <input
      type="color"
      id="colorPicker"
      value="#ff0000"
      onchange="sendColor(this.value)"
    />

    <br /><br />
    <button class="btn red" onclick="setRGB(255,0,0)">אדום</button>
    <button class="btn green" onclick="setRGB(0,255,0)">ירוק</button>
    <button class="btn blue" onclick="setRGB(0,0,255)">כחול</button>
    <button class="btn rnd" id="btn-rnd" onclick="setRandom()">רנדומלי</button>
    <button class="btn rainbow" onclick="setRainbow()">קשת</button>
    <button class="btn ambilight" onclick="setAmbilight()">אור דינמי</button>
    <br />
    <input
      type="range"
      min="0"
      max="100"
      value="50"
      onchange="changeBrightness(this.value)"
    />
    <br />
    <button class="btn off" onclick="setRGB(0,0,0)">כיבוי אורות</button>

    <script>
      // פונקציה ששולחת את הצבע לשרת בלי לרענן את הדף (AJAX/Fetch)
      function setRGB(r, g, b) {
        console.log("Sending: " + r + "," + g + "," + b);
        fetch("/set?r=" + r + "&g=" + g + "&b=" + b);
      }

      // המרה מפורמט HEX של הדפדפן ל-RGB שה-ESP מבין
      function sendColor(hex) {
        // מסיר את הסולמית
        hex = hex.replace("#", "");
        // ממיר בסיס 16 לבסיס 10
        var r = parseInt(hex.substring(0, 2), 16);
        var g = parseInt(hex.substring(2, 4), 16);
        var b = parseInt(hex.substring(4, 6), 16);
        setRGB(r, g, b);
      }
      function setRandom() {
        r = Math.floor(Math.random() * 256);
        g = Math.floor(Math.random() * 256);
        b = Math.floor(Math.random() * 256);
        const btnRnd = document.getElementById("btn-rnd");
        btnRnd.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
        setRGB(r, g, b);
      }
      function changeBrightness(brightness) {
        console.log("Sending: " + brightness);
        fetch("/brightness?val=" + brightness);
      }
      function setRainbow() {
        fetch("/mode?m=rainbow");
      }
      function setAmbilight() {
        fetch("/mode?m=ambilight");
      }
    </script>
  </body>
</html>
